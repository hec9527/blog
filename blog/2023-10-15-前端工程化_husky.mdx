---
title: å‰ç«¯å·¥ç¨‹åŒ–é…ç½®ï¼ˆå››ï¼‰â€”â€” husky
author: hec9527
author_title: å‰ç«¯åˆ‡å›¾å·¥ç¨‹å¸ˆ
author_url: https://github.com/hec9527
author_image_url: /img/avatar-circle.png
description: husky
keywords: [javascript, å·¥ç¨‹åŒ–, å·¥å…·]
tags: [javascript, å·¥ç¨‹åŒ–, å·¥å…·]
# draft: true
# image:
---

husky æ˜¯ä¸€ä¸ªç”¨äºåœ¨ Git é’©å­ï¼ˆGit hooksï¼‰ä¸­è¿è¡Œè„šæœ¬çš„å·¥å…·ï¼Œå®ƒå…è®¸ä½ åœ¨ä»£ç æäº¤ã€ä»£ç æ¨é€ç­‰ Git äº‹ä»¶å‘ç”Ÿæ—¶æ‰§è¡Œä¸€äº›é¢„å®šä¹‰çš„è„šæœ¬ä»»åŠ¡ã€‚è¿™å¯ä»¥å¸®åŠ©ä½ åœ¨æäº¤ä»£ç ä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œä¸€äº›è‡ªå®šä¹‰çš„æ“ä½œï¼Œä»¥ç¡®ä¿ä»£ç çš„ä¸€è‡´æ€§ã€è´¨é‡å’Œè§„èŒƒæ€§

![](img/2023-10-15-å‰ç«¯å·¥ç¨‹åŒ–_husky/husky.jpg)

<!-- truncate -->

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

Husky çš„ä¸»è¦ç”¨äº

- **ä»£ç è§„èŒƒæ£€æŸ¥ï¼š** åœ¨æäº¤ä»£ç ä¹‹å‰ï¼Œä½¿ç”¨ husky è¿è¡Œä»£ç è§„èŒƒæ£€æŸ¥å·¥å…·ï¼Œå¦‚ eslintã€stylelint ç­‰ï¼Œç¡®ä¿ä»£ç çš„ä¸€è‡´æ€§ã€è´¨é‡å’Œè§„èŒƒæ€§
- **è¿è¡Œå•å…ƒæµ‹è¯•ï¼š** åœ¨æäº¤ä»£ç ä¹‹å‰ï¼Œä½¿ç”¨ husky è¿è¡Œå•å…ƒæµ‹è¯•ï¼Œç¡®ä¿æ²¡æœ‰ç ´åç°æœ‰çš„åŠŸèƒ½
- **è‡ªåŠ¨åŒ–æ„å»ºï¼š**åœ¨æäº¤æˆ–æ¨é€ä¹‹å‰è¿è¡Œæ„å»ºè„šæœ¬ï¼Œå»æŠ¥æ–°ä»£ç èƒ½æ­£ç¡®çš„æ„å»ºå’Œæ‰“åŒ…
- **æ£€æŸ¥æäº¤ä¿¡æ¯ï¼š**åœ¨æäº¤ä»£ç å‰ï¼Œæ£€æŸ¥æäº¤ä¿¡æ¯æ˜¯å¦ç¬¦åˆé¢„å®šçš„è§„èŒƒï¼Œæ¯”å¦‚ [Conventional Commits è§„èŒƒ](https://www.conventionalcommits.org/en/v1.0.0/)
- **é˜»æ­¢ä¸åˆè§„çš„æäº¤ï¼š** å¦‚æœåœ¨é’©å­ä¸­å‘ç°é—®é¢˜ï¼Œhusky å…è®¸ä½ é˜»æ­¢æäº¤æˆ–æ¨é€ï¼Œä»¥ç¡®ä¿åªæœ‰åˆè§„çš„ä»£ç è¿›å…¥ä»£ç åº“

## å®‰è£…

åœ¨ git ä»“åº“ä¸­ï¼Œä½¿ç”¨ `husky-init` è‡ªåŠ¨å®‰è£…

<Tabs>
<TabItem value="npm" label="npm" default>

```bash
npx husky-init && npm install
```

</TabItem>
<TabItem value="yarn" label="yarn">

```bash
yarn add husky --dev
```

</TabItem>
<TabItem value="pnpm" label="pnpm">

```bash
pnpm dlx husky-init && pnpm install
```

</TabItem>

</Tabs>

`husky-init`é»˜è®¤ä¼šåšä»¥ä¸‹æ“ä½œ

1. åœ¨ `package.json` ä¸­æ·»åŠ  `prepare` å‘½ä»¤
2. åˆ›å»ºä¸€ä¸ª `pre-commit` çš„ hook
3. é…ç½® git hooks çš„è·¯å¾„

åˆå§‹åŒ–å®Œæˆåé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ä¼šæ–°å»ºä¸€ä¸ª `.husky` æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªæ–‡ä»¶ `pre-commit`ï¼Œç”¨äºæäº¤ï¼ˆgit commitï¼‰å‰æ‰§è¡Œçš„è„šæœ¬ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ›å»ºé’©å­æ–‡ä»¶ï¼Œæ¯”å¦‚ `pre-push`ï¼Œä¸‹é¢è¿™ä¸ªè„šæœ¬ä¼šåœ¨ git push ä¹‹å‰æ‰§è¡Œ lint è„šæœ¬

```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

npm run lint
```

## é…ç½®ä»£ç æ£€æµ‹

lint-staged æ˜¯ä¸€ä¸ªç”¨äºåœ¨æäº¤ä»£ç å‰è¿è¡Œé¢„å®šçš„è„šæœ¬ï¼ˆä¾‹å¦‚ä»£ç æ ¼å¼åŒ–ã€é™æ€ä»£ç åˆ†æç­‰ï¼‰çš„å·¥å…·ã€‚æˆ‘ä»¬å°†å®ƒä¸ husky ç»“åˆä½¿ç”¨ï¼Œåœ¨æäº¤ä»£ç å‰è¿è¡Œ eslintã€stylelintã€prettier ç­‰ä»£ç æ£€æµ‹å·¥å…·

<Tabs>
<TabItem value="npm" label="npm" default>

```bash
npm install -D lint-staged
```

</TabItem>
<TabItem value="yarn" label="yarn">

```bash
yarn add -D lint-staged
```

</TabItem>
<TabItem value="pnpm" label="pnpm">

```bash
pnpm install -D lint-staged
```

</TabItem>

</Tabs>

lint-staged ä½¿ç”¨ [lilconfig](https://github.com/antonk52/lilconfig) ä½œä¸ºåŠ è½½é…ç½®æ–‡ä»¶çš„å·¥å…·ï¼Œå®ƒæ”¯æŒä¸€ä¸‹é…ç½®æ–‡ä»¶

```text
package.json
.lint-stagedrc
.lint-stagedrc.js
.lint-stagedrc.cjs
.lint-stagedrc.mjs
.lint-stagedrc.json
.lint-stagedrc.yaml
.lint-stagedrc.yml
`lint-staged` in `package.json`
```

lint-staged çš„é…ç½®æ–‡ä»¶éœ€è¦å¯¼å‡ºä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹å¯¹è±¡çš„ key æ˜¯ä¸€ä¸ª glob åŒ¹é…æ¨¡å¼ï¼Œvalue æ˜¯ä¸€ä¸ªéœ€è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œå‘½ä»¤å¯ä»¥è·Ÿå‚æ•°ã€‚

```json title=".lint-stagedrc"
{
  "*.js,*.jsx": "eslint",
  "*.less": "stylelint",
  "*": "prettier -w"
}
```

æˆ‘ä»¬ä¿®æ”¹ä¹‹å‰åˆ›å»ºçš„ `pre-commit` è„šæœ¬ï¼Œå¹¶åœ¨å…¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œæ­¤æ—¶æ‰§è¡Œ git commit ä¹‹å‰ä¼šå…ˆæ‰§è¡Œ lint æ“ä½œï¼Œlint æ£€æŸ¥é€šè¿‡åæ‰ä¼šæäº¤ä»£ç ã€‚ğŸš«ğŸ’©

```bash title=".husky/pre-commit"
#!/usr/bin/env sh

npx --no -- lint-staged
```

## é…ç½®æäº¤è§„èŒƒ

åœ¨ä»¥ä¸‹å¼€æºé¡¹ç›®ä¸­ï¼Œé€šå¸¸ä¼šé…ç½®ä»£ç æäº¤è§„èŒƒï¼Œé˜²æ­¢æäº¤ä¿¡æ¯éšä¾¿å†™ï¼Œæ•·è¡äº†äº‹ï¼Œæ¯”å¦‚ `"update"`ï¼Œ`"fix issue"`è¿™ç§çœ‹äº†ä¸çŸ¥é“æ”¹äº†å•¥çš„æäº¤ä¿¡æ¯ï¼Œ
å¦å¤–é€šè¿‡è§„èŒƒæäº¤ä¿¡æ¯ï¼Œä¹Ÿèƒ½å¤Ÿé€šè¿‡ `git log --grep` å¿«é€Ÿè¿‡æ»¤å‡ºç›¸å…³æäº¤ï¼Œä¾¿äºæŸ¥æ‰¾é—®é¢˜ï¼Œä¸ºäº†è§„èŒƒæäº¤ commitï¼Œä¾¿æœ‰äº†
[commitlint](https://commitlint.js.org/#/)ã€‚å®ƒå¯ä»¥æ£€æµ‹æˆ‘ä»¬çš„ commit ä¿¡æ¯ï¼Œå¦‚æœä¸ç¬¦åˆè§„èŒƒï¼Œåˆ™ä¼šé˜»æ­¢æäº¤ã€‚

<Tabs>
<TabItem value="npm" label="npm" default>

```bash
npm install -D @commitlint/{cli,config-conventional}
```

</TabItem>
<TabItem value="yarn" label="yarn">

```bash
yarn add -D @commitlint/{cli,config-conventional}
```

</TabItem>

<TabItem value="pnpm" label="pnpm">

```bash
pnpm install -D @commitlint/{cli,config-conventional}
```

</TabItem>

</Tabs>

åŒæ ·çš„ commitlint ä¹Ÿæ”¯æŒå¤šç§é…ç½®æ–‡ä»¶ï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º `commitlint.config.js` æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¾¿å¼•å…¥äº† [conventional commit è§„èŒƒ](https://www.conventionalcommits.org/en/v1.0.0/)

```js title="commitlint.config.js"
module.exports = {
  extends: ['@commitlint/config-conventional'],
};
```

åœ¨ husky ä¸­æ·»åŠ  `commit-msg` é’©å­ï¼Œç„¶ååœ¨å…¶ä¸­è°ƒç”¨ commitlint è¿›è¡Œæ£€æµ‹ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬åœ¨æäº¤æ—¶ï¼Œè¾“å…¥çš„æäº¤ä¿¡æ¯ä¸ç¬¦åˆè§„èŒƒæ—¶ï¼Œcommitlint ä¼šé˜»æ­¢æäº¤ï¼Œå¹¶ç»™å‡ºæç¤ºã€‚

```bash title=".husky/commit-msg"
#!/usr/bin/env sh
. "$(dirname -- "")/_/husky.sh"

npx -- commitlint --edit "$0"
```

### conventional commit è§„èŒƒ\*\*

è§„èŒƒè§„å®šäº† commit çš„æ ¼å¼ï¼Œä¸»è¦ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼Œbody å’Œ footer éƒ½æ˜¯å¯é€‰çš„ï¼Œheader ä¿¡æ¯ä¸èƒ½çœç•¥ã€‚å¦å¤– header ä¸­çš„ scope æ˜¯å¯é€‰çš„ï¼Œå¦‚æœæ²¡æœ‰ scopeï¼Œåˆ™å¯ä»¥çœç•¥ã€‚

```text
<type>(<scope>): <subject>
// ç©ºä¸€è¡Œ
<body>
// ç©ºä¸€è¡Œ
<footer>
```

#### type

type æ˜¯å¿…éœ€çš„ï¼Œç”¨äºè¯´æ˜ commit çš„ç±»åˆ«ï¼Œåªå…è®¸ä½¿ç”¨ä¸‹é¢å‡ ä¸ªæ ‡è¯†ã€‚

- build: å½±å“æ„å»ºç³»ç»Ÿæˆ–å¤–éƒ¨ä¾èµ–ï¼ˆä¾‹å¦‚ scopes: gulp, broccoli, npmï¼‰çš„ä¿®æ”¹
- ci: å½±å“ CI é…ç½®æ–‡ä»¶å’Œè„šæœ¬çš„ä¿®æ”¹
- docs: ä»…ä»…æ˜¯æ–‡æ¡£çš„ä¿®æ”¹
- feat: ä¸€ä¸ªæ–°åŠŸèƒ½
- fix: ä¿®å¤ä¸€ä¸ª bug
- perf: ä¼˜åŒ–æ€§èƒ½
- refactor: ä»£ç é‡æ„
- style: ä¸å½±å“ä»£ç å«ä¹‰çš„ä¿®æ”¹ï¼ˆç©ºæ ¼ã€æ ¼å¼ã€ç¼ºå°‘åˆ†å·ç­‰ï¼‰
- test: æ·»åŠ ç¼ºå¤±çš„æµ‹è¯•æˆ–æ›´æ­£ç°æœ‰æµ‹è¯•
- chore: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨
- revert: å›æ»šæŸä¸ª commit

#### scope

scope ç”¨äºè¯´æ˜ commit å½±å“çš„èŒƒå›´ï¼Œæ¯”å¦‚æ•°æ®å±‚ã€æ§åˆ¶å±‚ã€è§†å›¾å±‚ç­‰ç­‰ï¼Œå‰ç«¯é¡¹ç›®å¯èƒ½ä¼šæ˜¯é¡µé¢ã€æ•°æ®å±‚ã€ç»„ä»¶ã€å·¥å…·å‡½æ•°ç­‰ã€‚

#### subject

subject æ˜¯ commit çš„ç®€çŸ­æè¿°ï¼Œä¸è¶…è¿‡ 50 ä¸ªå­—ç¬¦ï¼ŒåŒ…å«äº†æœ¬æ¬¡ä¿®æ”¹çš„å†…å®¹å’ŒåŸå› ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ subject ä¸å†’å·ä¹‹é—´æœ‰ä¸€ä¸ªç©ºæ ¼ã€‚

#### ä¾‹å­

```text
feat(parser): add ability to parse arrays

* add `parseArray` method
* add `parseObject` method
```

#### body

body æ˜¯å¯¹æœ¬æ¬¡ commit çš„è¯¦ç»†æè¿°ï¼Œå¯ä»¥åˆ†æˆå¤šè¡Œï¼ŒåŒ…å«äº†æœ¬æ¬¡ä¿®æ”¹çš„åŠ¨æœºå’Œå®ç°æ–¹æ³•ã€‚

#### footer

footer æ˜¯å¯¹æœ¬æ¬¡ commit çš„å…³é—­ issue çš„æè¿°ï¼Œå¯ä»¥å†™å¤šä¸ª issueï¼Œä¹Ÿå¯ä»¥å†™å…³é—­çš„ issue çš„é“¾æ¥ã€‚

## æ€»ç»“

ä»¥ä¸Šå°±æ˜¯å‰ç«¯å·¥ç¨‹åŒ–çš„åŸºæœ¬æµç¨‹ï¼Œé€šè¿‡ huskyã€lint-stagedã€commitlint ç­‰å·¥å…·ï¼Œå¯ä»¥å®ç°ä»£ç æ£€æµ‹ã€è§„èŒƒæäº¤ä¿¡æ¯ï¼Œæé«˜ä»£ç è´¨é‡ï¼Œå‡å°‘ bugã€‚

## å‚è€ƒèµ„æ–™

- [husky](https://github.com/typicode/husky)
- [lint-staged](https://www.npmjs.com/package/lint-staged)
- [commitlint](https://commitlint.js.org/#/)
